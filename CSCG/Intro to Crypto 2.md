# Intro to Crypto 2
**Category:** Crypto  
**Difficulty:** Baby  
**Author:** black-simon  

>This is an introductory challenge for beginners which want to dive into the world of Cryptography. The three stages of this challenge will increase in difficulty. I learned my lesson from the mistakes made in the last challenge! Now p and q are huge, I promise!

## Solution
We are given a the _cipher message_ and the _public key_ used to encrypt it. RSA is used for encryption. We can use _openssl_ to extract the modulus and exponent from the file.
```bash
$openssl rsa -noout -modulus -pubin -in pubkey.pem -text
RSA Public-Key: (2047 bit)
Modulus:
    57:c8:8f:1c:9b:9e:d4:7d:84:4f:87:b2:9f:44:79:
    6e:17:ce:47:c2:fe:24:cc:1a:b7:e3:44:32:b3:35:
    21:24:63:d2:39:9d:07:47:11:80:05:72:ea:68:12:
    e2:90:12:02:bc:5f:19:0c:cb:49:66:d5:70:90:4a:
    41:69:7a:63:64:48:8a:e1:40:b1:b6:35:7f:c6:a6:
    b4:ac:cd:51:7a:74:03:bb:c9:96:df:d0:72:89:5f:
    6a:9a:1e:a8:f2:a6:da:b6:9d:a1:55:75:17:7f:4c:
    ef:1a:db:90:82:5b:bd:4f:ec:50:01:aa:c0:1a:70:
    e8:a1:0e:10:13:34:71:39:32:be:47:d1:a0:9d:70:
    d3:11:57:fe:26:e5:53:77:4f:8d:9e:50:20:98:47:
    2b:ca:87:07:93:1e:2b:c9:cb:92:aa:c9:44:51:be:
    6f:1e:55:8b:93:a8:68:5c:e9:84:f4:84:0a:fa:f8:
    d2:a8:ad:0d:46:54:54:62:a9:18:15:1a:50:de:a1:
    a2:8f:4d:f1:e5:e6:99:b0:05:2d:a5:23:05:9e:b2:
    1d:56:b6:7c:91:e5:6a:b7:5f:35:bc:9f:64:9b:ea:
    76:a1:36:b1:70:d3:a6:76:f5:14:b9:c8:95:5e:af:
    78:a9:0b:ad:d5:48:5b:ba:7f:12:17:8b:1f:8f:ef:
    ef
Exponent: 65537 (0x10001)
Modulus=57C88F1C9B9ED47D844F87B29F44796E17CE47C2FE24CC1AB7E34432B335212463D2399D074711800572EA6812E2901202BC5F190CCB4966D570904A41697A6364488AE140B1B6357FC6A6B4ACCD517A7403BBC996DFD072895F6A9A1EA8F2A6DAB69DA15575177F4CEF1ADB90825BBD4FEC5001AAC01A70E8A10E101334713932BE47D1A09D70D31157FE26E553774F8D9E502098472BCA8707931E2BC9CB92AAC94451BE6F1E558B93A8685CE984F4840AFAF8D2A8AD0D46545462A918151A50DEA1A28F4DF1E5E699B0052DA523059EB21D56B67C91E56AB75F35BC9F649BEA76A136B170D3A676F514B9C8955EAF78A90BADD5485BBA7F12178B1F8FEFEF
```
We cannot directly find the factors, but we can still find them. Finding the factors requires some other algorithms. We are gonna let alpertron do the hard work. This [website](https://www.alpertron.com.ar/ECM.HTM) allows us to find the factors. Since we can find the factors of modulus, we can also find the decryption key.
```python
message = 6213639477312598145146606285597413094756028916460209994926376562685721597532354994527411261035070313371565996179096901618661905020103824302567694878011247857685359643790779936360396061892681963343509949795893998949164356297380564973147847768251471545846793414196863838506235390508670540548621210855302903513284961283614161501466772253041178512706947379642827461605012461899803919210999488026352375214758873859352222530502137358426056819293786590877544792321648180554981415658300194184367096348141488594780860400420776664995973439686986538967952922269183014996803258574382869102287844486447643771783747439478831567060
Modulus = 0x57C88F1C9B9ED47D844F87B29F44796E17CE47C2FE24CC1AB7E34432B335212463D2399D074711800572EA6812E2901202BC5F190CCB4966D570904A41697A6364488AE140B1B6357FC6A6B4ACCD517A7403BBC996DFD072895F6A9A1EA8F2A6DAB69DA15575177F4CEF1ADB90825BBD4FEC5001AAC01A70E8A10E101334713932BE47D1A09D70D31157FE26E553774F8D9E502098472BCA8707931E2BC9CB92AAC94451BE6F1E558B93A8685CE984F4840AFAF8D2A8AD0D46545462A918151A50DEA1A28F4DF1E5E699B0052DA523059EB21D56B67C91E56AB75F35BC9F649BEA76A136B170D3A676F514B9C8955EAF78A90BADD5485BBA7F12178B1F8FEFEF

e = 0x10001

p = 105269330176947292996638200435938306898008923026214454261833875185727477089897046111427146733705930821830266909665628457524081078905360676252447567252776868229878866771906188152589974886284283170888631961882151644823439854179072943695999068501018297820499189273623372907923121271707038222250931356234064474919
q = 105269330176947292996638200435938306898008923026214454261833875185727477089897046111427146733705930821830266909665628457524081078905360676252447567252776868229878866771906188152589974886284283170888631961882151644823439854179072943695999068501018297820499189273623372907923121271707038222250931356234064574969

phi = Modulus - q - p + 1

def multiplicative_inverse(a, b):
    x = 0
    y = 1
    lx = 1
    ly = 0
    oa = a
    ob = b
    while b != 0:
        q = a // b
        (a, b) = (b, a % b)
        (x, lx) = ((lx - (q * x)), x)
        (y, ly) = ((ly - (q * y)), y)
    if lx < 0:
        lx += ob
    if ly < 0:
        ly += oa

    return lx

d = multiplicative_inverse(e,phi)
from Crypto.Util.number import long_to_bytes
plaintext = pow(message, d, Modulus)
print(long_to_bytes(plaintext))
```
This little program allows us to decrypt the cipher and get the flag.
```bash
$python3 solve.py
b'CSCG{Ok,_next_time_I_choose_p_and_q_random...}'
```

### CSCG{Ok,\_next\_time\_I\_choose\_p\_and\_q\_random...}
